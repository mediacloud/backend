#
# SSL terminating reverse proxy
#

FROM dockermediacloud/nginx-base:latest

# Install packages
RUN \
    #
    # Install htpasswd
    apt-get -y --no-install-recommends install apache2-utils && \
    true

# Copy dhparams.pem file
COPY nginx/dhparams.pem /etc/nginx/

# Copy configuration
COPY nginx/include/proxy-httpd.conf /etc/nginx/include/

# Copy wrapper script
COPY bin /opt/mediacloud/bin
ENV PATH "/opt/mediacloud/bin:${PATH}"

# Volume for issued certificates
# (generated by proxy_cron_certbot)
VOLUME /etc/letsencrypt/

# No USER because Nginx accesses /etc/letsencrypt/ and runs as "nobody" by default

# Start nginx
CMD ["nginx.sh"]
